<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Menu Principal - CRUD Doceria</title>
  <link rel="stylesheet" href="menu.css">
  <style>
    /* ğŸ”¹ BotÃ£o de Voltar */
    #voltar-btn {
      position: fixed;
      top: 15px;
      left: 15px;
      background-color: #4b236b;
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      transition: background 0.3s;
      z-index: 1000;
    }

    #voltar-btn:hover {
      background-color: #4b236b;
    }

    header {
      text-align: center;
      margin-top: 60px; /* ğŸ”¹ EspaÃ§o para nÃ£o sobrepor o botÃ£o */
    }
  </style>
</head>
<body>
  <!-- ğŸ”¹ BotÃ£o de voltar -->
  <button id="voltar-btn" onclick="window.location.href='index.html'">â¬… Voltar</button>

  <header>
    <h1>Menu Principal - CRUD Doceria</h1>
  </header>

  <main>
    <div class="menu-container">
      <div class="menu-card">
        <h2>ğŸ© Doce</h2>
        <a href="doce/doce.html">Acessar</a>
      </div>

      <div class="menu-card">
        <h2>ğŸ¥š Ingrediente</h2>
        <a href="ingrediente/ingrediente.html">Acessar</a>
      </div>

      <div class="menu-card">
        <h2>ğŸ§ Cliente</h2>
        <a href="cliente/cliente.html">Acessar</a>
      </div>

      <div class="menu-card">
        <h2>ğŸ« FuncionÃ¡rio</h2>
        <a href="funcionario/funcionario.html">Acessar</a>
      </div>

      <div class="menu-card">
        <h2>ğŸª Pedido</h2>
        <a href="pedido/pedido.html">Acessar</a>
      </div>

      <div class="menu-card">
        <h2>ğŸ‘¤ Pessoa</h2>
        <a href="pessoa/pessoa.html">Acessar</a>
      </div>
      
      <div class="menu-card">
        <h2>ğŸ“Š RelatÃ³rios</h2>
        <a href="menu-relatorios.html">Acessar</a>
      </div>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 Sistema de Doceria</p>
  </footer>

  <script>
    // Proteger acesso ao menu - apenas gerentes podem acessar
    window.addEventListener('DOMContentLoaded', () => {
      const token = localStorage.getItem('token');
      
      if (!token) {
        alert('âŒ Acesso negado. VocÃª precisa estar logado.');
        window.location.href = 'index.html';
        return;
      }

      // Verificar se Ã© gerente usando endpoint leve
      const checkGerente = async () => {
        try {
          // Tenta primeiro com token do localStorage (Authorization header)
          if (token) {
            const r = await fetch('/api/auth/is-gerente', { headers: { 'Authorization': `Bearer ${token}` } });
            if (r.ok) {
              const d = await r.json();
              if (d && d.isGerente) return true;
            }
          }

          // Se nÃ£o hÃ¡ token ou autorizaÃ§Ã£o falhou, tenta com cookie (credentials include)
          const r2 = await fetch('/api/auth/is-gerente', { credentials: 'include' });
          if (r2.ok) {
            const d2 = await r2.json();
            if (d2 && d2.isGerente) return true;
          }

          return false;
        } catch (err) {
          console.error('Erro verificando gerente:', err);
          return false;
        }
      };

      checkGerente().then(isG => {
        if (!isG) {
          alert('âŒ Acesso negado. Apenas gerentes podem acessar este menu.');
          window.location.href = 'index.html';
        }
      });
    });
  </script>
</body>
</html>
